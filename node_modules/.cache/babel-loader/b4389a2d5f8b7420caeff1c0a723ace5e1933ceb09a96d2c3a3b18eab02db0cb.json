{"ast":null,"code":"import { Color, HalfFloatType, MeshDepthMaterial, NearestFilter, NoBlending, RGBADepthPacking, ShaderMaterial, UniformsUtils, WebGLRenderTarget } from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\n/**\n * Depth-of-field post-process with bokeh shader\n */\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0;\n\n    // render targets\n\n    this.renderTargetDepth = new WebGLRenderTarget(1, 1, {\n      // will be resized later\n      minFilter: NearestFilter,\n      magFilter: NearestFilter,\n      type: HalfFloatType\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth';\n\n    // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending;\n\n    // bokeh material\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = camera.aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n  render(renderer, writeBuffer, readBuffer /*, deltaTime, maskActive*/) {\n    // Render depth into texture\n\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera);\n\n    // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n  setSize(width, height) {\n    this.materialBokeh.uniforms['aspect'].value = width / height;\n    this.renderTargetDepth.setSize(width, height);\n  }\n  dispose() {\n    this.renderTargetDepth.dispose();\n    this.materialDepth.dispose();\n    this.materialBokeh.dispose();\n    this.fsQuad.dispose();\n  }\n}\nexport { BokehPass };","map":{"version":3,"names":["Color","HalfFloatType","MeshDepthMaterial","NearestFilter","NoBlending","RGBADepthPacking","ShaderMaterial","UniformsUtils","WebGLRenderTarget","Pass","FullScreenQuad","BokehShader","BokehPass","constructor","scene","camera","params","focus","undefined","aperture","maxblur","renderTargetDepth","minFilter","magFilter","type","texture","name","materialDepth","depthPacking","blending","bokehShader","bokehUniforms","clone","uniforms","value","aspect","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","fsQuad","_oldClearColor","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen","setSize","width","height","dispose"],"sources":["/home/ervin/Escritorio/integrador/Projecto-Integrador-1-Game/node_modules/three/examples/jsm/postprocessing/BokehPass.js"],"sourcesContent":["import {\n\tColor,\n\tHalfFloatType,\n\tMeshDepthMaterial,\n\tNearestFilter,\n\tNoBlending,\n\tRGBADepthPacking,\n\tShaderMaterial,\n\tUniformsUtils,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\n/**\n * Depth-of-field post-process with bokeh shader\n */\n\nclass BokehPass extends Pass {\n\n\tconstructor( scene, camera, params ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tconst focus = ( params.focus !== undefined ) ? params.focus : 1.0;\n\t\tconst aperture = ( params.aperture !== undefined ) ? params.aperture : 0.025;\n\t\tconst maxblur = ( params.maxblur !== undefined ) ? params.maxblur : 1.0;\n\n\t\t// render targets\n\n\t\tthis.renderTargetDepth = new WebGLRenderTarget( 1, 1, { // will be resized later\n\t\t\tminFilter: NearestFilter,\n\t\t\tmagFilter: NearestFilter,\n\t\t\ttype: HalfFloatType\n\t\t} );\n\n\t\tthis.renderTargetDepth.texture.name = 'BokehPass.depth';\n\n\t\t// depth material\n\n\t\tthis.materialDepth = new MeshDepthMaterial();\n\t\tthis.materialDepth.depthPacking = RGBADepthPacking;\n\t\tthis.materialDepth.blending = NoBlending;\n\n\t\t// bokeh material\n\n\t\tconst bokehShader = BokehShader;\n\t\tconst bokehUniforms = UniformsUtils.clone( bokehShader.uniforms );\n\n\t\tbokehUniforms[ 'tDepth' ].value = this.renderTargetDepth.texture;\n\n\t\tbokehUniforms[ 'focus' ].value = focus;\n\t\tbokehUniforms[ 'aspect' ].value = camera.aspect;\n\t\tbokehUniforms[ 'aperture' ].value = aperture;\n\t\tbokehUniforms[ 'maxblur' ].value = maxblur;\n\t\tbokehUniforms[ 'nearClip' ].value = camera.near;\n\t\tbokehUniforms[ 'farClip' ].value = camera.far;\n\n\t\tthis.materialBokeh = new ShaderMaterial( {\n\t\t\tdefines: Object.assign( {}, bokehShader.defines ),\n\t\t\tuniforms: bokehUniforms,\n\t\t\tvertexShader: bokehShader.vertexShader,\n\t\t\tfragmentShader: bokehShader.fragmentShader\n\t\t} );\n\n\t\tthis.uniforms = bokehUniforms;\n\n\t\tthis.fsQuad = new FullScreenQuad( this.materialBokeh );\n\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer/*, deltaTime, maskActive*/ ) {\n\n\t\t// Render depth into texture\n\n\t\tthis.scene.overrideMaterial = this.materialDepth;\n\n\t\trenderer.getClearColor( this._oldClearColor );\n\t\tconst oldClearAlpha = renderer.getClearAlpha();\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\trenderer.setClearColor( 0xffffff );\n\t\trenderer.setClearAlpha( 1.0 );\n\t\trenderer.setRenderTarget( this.renderTargetDepth );\n\t\trenderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// Render bokeh composite\n\n\t\tthis.uniforms[ 'tColor' ].value = readBuffer.texture;\n\t\tthis.uniforms[ 'nearClip' ].value = this.camera.near;\n\t\tthis.uniforms[ 'farClip' ].value = this.camera.far;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t\tthis.scene.overrideMaterial = null;\n\t\trenderer.setClearColor( this._oldClearColor );\n\t\trenderer.setClearAlpha( oldClearAlpha );\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis.materialBokeh.uniforms[ 'aspect' ].value = width / height;\n\n\t\tthis.renderTargetDepth.setSize( width, height );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.renderTargetDepth.dispose();\n\n\t\tthis.materialDepth.dispose();\n\t\tthis.materialBokeh.dispose();\n\n\t\tthis.fsQuad.dispose();\n\n\t}\n\n}\n\nexport { BokehPass };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}