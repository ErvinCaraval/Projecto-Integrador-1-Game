{"ast":null,"code":"import { AdditiveBlending, HalfFloatType, ShaderMaterial, UniformsUtils, Vector2, WebGLRenderTarget } from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { ConvolutionShader } from '../shaders/ConvolutionShader.js';\nclass BloomPass extends Pass {\n  constructor(strength = 1, kernelSize = 25, sigma = 4) {\n    super();\n\n    // render targets\n\n    this.renderTargetX = new WebGLRenderTarget(1, 1, {\n      type: HalfFloatType\n    }); // will be resized later\n    this.renderTargetX.texture.name = 'BloomPass.x';\n    this.renderTargetY = new WebGLRenderTarget(1, 1, {\n      type: HalfFloatType\n    }); // will be resized later\n    this.renderTargetY.texture.name = 'BloomPass.y';\n\n    // combine material\n\n    this.combineUniforms = UniformsUtils.clone(CombineShader.uniforms);\n    this.combineUniforms['strength'].value = strength;\n    this.materialCombine = new ShaderMaterial({\n      name: CombineShader.name,\n      uniforms: this.combineUniforms,\n      vertexShader: CombineShader.vertexShader,\n      fragmentShader: CombineShader.fragmentShader,\n      blending: AdditiveBlending,\n      transparent: true\n    });\n\n    // convolution material\n\n    const convolutionShader = ConvolutionShader;\n    this.convolutionUniforms = UniformsUtils.clone(convolutionShader.uniforms);\n    this.convolutionUniforms['uImageIncrement'].value = BloomPass.blurX;\n    this.convolutionUniforms['cKernel'].value = ConvolutionShader.buildKernel(sigma);\n    this.materialConvolution = new ShaderMaterial({\n      name: convolutionShader.name,\n      uniforms: this.convolutionUniforms,\n      vertexShader: convolutionShader.vertexShader,\n      fragmentShader: convolutionShader.fragmentShader,\n      defines: {\n        'KERNEL_SIZE_FLOAT': kernelSize.toFixed(1),\n        'KERNEL_SIZE_INT': kernelSize.toFixed(0)\n      }\n    });\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(null);\n  }\n  render(renderer, writeBuffer, readBuffer, deltaTime, maskActive) {\n    if (maskActive) renderer.state.buffers.stencil.setTest(false);\n\n    // Render quad with blured scene into texture (convolution pass 1)\n\n    this.fsQuad.material = this.materialConvolution;\n    this.convolutionUniforms['tDiffuse'].value = readBuffer.texture;\n    this.convolutionUniforms['uImageIncrement'].value = BloomPass.blurX;\n    renderer.setRenderTarget(this.renderTargetX);\n    renderer.clear();\n    this.fsQuad.render(renderer);\n\n    // Render quad with blured scene into texture (convolution pass 2)\n\n    this.convolutionUniforms['tDiffuse'].value = this.renderTargetX.texture;\n    this.convolutionUniforms['uImageIncrement'].value = BloomPass.blurY;\n    renderer.setRenderTarget(this.renderTargetY);\n    renderer.clear();\n    this.fsQuad.render(renderer);\n\n    // Render original scene with superimposed blur to texture\n\n    this.fsQuad.material = this.materialCombine;\n    this.combineUniforms['tDiffuse'].value = this.renderTargetY.texture;\n    if (maskActive) renderer.state.buffers.stencil.setTest(true);\n    renderer.setRenderTarget(readBuffer);\n    if (this.clear) renderer.clear();\n    this.fsQuad.render(renderer);\n  }\n  setSize(width, height) {\n    this.renderTargetX.setSize(width, height);\n    this.renderTargetY.setSize(width, height);\n  }\n  dispose() {\n    this.renderTargetX.dispose();\n    this.renderTargetY.dispose();\n    this.materialCombine.dispose();\n    this.materialConvolution.dispose();\n    this.fsQuad.dispose();\n  }\n}\nconst CombineShader = {\n  name: 'CombineShader',\n  uniforms: {\n    'tDiffuse': {\n      value: null\n    },\n    'strength': {\n      value: 1.0\n    }\n  },\n  vertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n  fragmentShader: /* glsl */`\n\n\t\tuniform float strength;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = strength * texel;\n\n\t\t}`\n};\nBloomPass.blurX = new Vector2(0.001953125, 0.0);\nBloomPass.blurY = new Vector2(0.0, 0.001953125);\nexport { BloomPass };","map":{"version":3,"names":["AdditiveBlending","HalfFloatType","ShaderMaterial","UniformsUtils","Vector2","WebGLRenderTarget","Pass","FullScreenQuad","ConvolutionShader","BloomPass","constructor","strength","kernelSize","sigma","renderTargetX","type","texture","name","renderTargetY","combineUniforms","clone","CombineShader","uniforms","value","materialCombine","vertexShader","fragmentShader","blending","transparent","convolutionShader","convolutionUniforms","blurX","buildKernel","materialConvolution","defines","toFixed","needsSwap","fsQuad","render","renderer","writeBuffer","readBuffer","deltaTime","maskActive","state","buffers","stencil","setTest","material","setRenderTarget","clear","blurY","setSize","width","height","dispose"],"sources":["/home/ervin/Escritorio/integrador/Projecto-Integrador-1-Game/node_modules/three/examples/jsm/postprocessing/BloomPass.js"],"sourcesContent":["import {\n\tAdditiveBlending,\n\tHalfFloatType,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { ConvolutionShader } from '../shaders/ConvolutionShader.js';\n\nclass BloomPass extends Pass {\n\n\tconstructor( strength = 1, kernelSize = 25, sigma = 4 ) {\n\n\t\tsuper();\n\n\t\t// render targets\n\n\t\tthis.renderTargetX = new WebGLRenderTarget( 1, 1, { type: HalfFloatType } ); // will be resized later\n\t\tthis.renderTargetX.texture.name = 'BloomPass.x';\n\t\tthis.renderTargetY = new WebGLRenderTarget( 1, 1, { type: HalfFloatType } ); // will be resized later\n\t\tthis.renderTargetY.texture.name = 'BloomPass.y';\n\n\t\t// combine material\n\n\t\tthis.combineUniforms = UniformsUtils.clone( CombineShader.uniforms );\n\n\t\tthis.combineUniforms[ 'strength' ].value = strength;\n\n\t\tthis.materialCombine = new ShaderMaterial( {\n\n\t\t\tname: CombineShader.name,\n\t\t\tuniforms: this.combineUniforms,\n\t\t\tvertexShader: CombineShader.vertexShader,\n\t\t\tfragmentShader: CombineShader.fragmentShader,\n\t\t\tblending: AdditiveBlending,\n\t\t\ttransparent: true\n\n\t\t} );\n\n\t\t// convolution material\n\n\t\tconst convolutionShader = ConvolutionShader;\n\n\t\tthis.convolutionUniforms = UniformsUtils.clone( convolutionShader.uniforms );\n\n\t\tthis.convolutionUniforms[ 'uImageIncrement' ].value = BloomPass.blurX;\n\t\tthis.convolutionUniforms[ 'cKernel' ].value = ConvolutionShader.buildKernel( sigma );\n\n\t\tthis.materialConvolution = new ShaderMaterial( {\n\n\t\t\tname: convolutionShader.name,\n\t\t\tuniforms: this.convolutionUniforms,\n\t\t\tvertexShader: convolutionShader.vertexShader,\n\t\t\tfragmentShader: convolutionShader.fragmentShader,\n\t\t\tdefines: {\n\t\t\t\t'KERNEL_SIZE_FLOAT': kernelSize.toFixed( 1 ),\n\t\t\t\t'KERNEL_SIZE_INT': kernelSize.toFixed( 0 )\n\t\t\t}\n\n\t\t} );\n\n\t\tthis.needsSwap = false;\n\n\t\tthis.fsQuad = new FullScreenQuad( null );\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer, deltaTime, maskActive ) {\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( false );\n\n\t\t// Render quad with blured scene into texture (convolution pass 1)\n\n\t\tthis.fsQuad.material = this.materialConvolution;\n\n\t\tthis.convolutionUniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.convolutionUniforms[ 'uImageIncrement' ].value = BloomPass.blurX;\n\n\t\trenderer.setRenderTarget( this.renderTargetX );\n\t\trenderer.clear();\n\t\tthis.fsQuad.render( renderer );\n\n\n\t\t// Render quad with blured scene into texture (convolution pass 2)\n\n\t\tthis.convolutionUniforms[ 'tDiffuse' ].value = this.renderTargetX.texture;\n\t\tthis.convolutionUniforms[ 'uImageIncrement' ].value = BloomPass.blurY;\n\n\t\trenderer.setRenderTarget( this.renderTargetY );\n\t\trenderer.clear();\n\t\tthis.fsQuad.render( renderer );\n\n\t\t// Render original scene with superimposed blur to texture\n\n\t\tthis.fsQuad.material = this.materialCombine;\n\n\t\tthis.combineUniforms[ 'tDiffuse' ].value = this.renderTargetY.texture;\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( true );\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\tthis.fsQuad.render( renderer );\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis.renderTargetX.setSize( width, height );\n\t\tthis.renderTargetY.setSize( width, height );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.renderTargetX.dispose();\n\t\tthis.renderTargetY.dispose();\n\n\t\tthis.materialCombine.dispose();\n\t\tthis.materialConvolution.dispose();\n\n\t\tthis.fsQuad.dispose();\n\n\t}\n\n}\n\nconst CombineShader = {\n\n\tname: 'CombineShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'strength': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float strength;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = strength * texel;\n\n\t\t}`\n\n};\n\nBloomPass.blurX = new Vector2( 0.001953125, 0.0 );\nBloomPass.blurY = new Vector2( 0.0, 0.001953125 );\n\nexport { BloomPass };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}