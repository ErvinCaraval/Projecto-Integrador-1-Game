{"ast":null,"code":"// http://download.autodesk.com/us/systemdocs/help/2011/lustre/index.html?url=./files/WSc4e151a45a3b785a24c3d9a411df9298473-7ffd.htm,topicNumber=d0e9492\n// https://community.foundry.com/discuss/topic/103636/format-spec-for-3dl?mode=Post&postID=895258\n\nimport { ClampToEdgeWrapping, DataTexture, Data3DTexture, FileLoader, FloatType, LinearFilter, Loader, RGBAFormat, UnsignedByteType } from 'three';\nexport class LUT3dlLoader extends Loader {\n  constructor(manager) {\n    super(manager);\n    this.type = UnsignedByteType;\n  }\n  setType(type) {\n    if (type !== UnsignedByteType && type !== FloatType) {\n      throw new Error('LUT3dlLoader: Unsupported type');\n    }\n    this.type = type;\n    return this;\n  }\n  load(url, onLoad, onProgress, onError) {\n    const loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setResponseType('text');\n    loader.load(url, text => {\n      try {\n        onLoad(this.parse(text));\n      } catch (e) {\n        if (onError) {\n          onError(e);\n        } else {\n          console.error(e);\n        }\n        this.manager.itemError(url);\n      }\n    }, onProgress, onError);\n  }\n  parse(input) {\n    const regExpGridInfo = /^[\\d ]+$/m;\n    const regExpDataPoints = /^([\\d.e+-]+) +([\\d.e+-]+) +([\\d.e+-]+) *$/gm;\n\n    // The first line describes the positions of values on the LUT grid.\n    let result = regExpGridInfo.exec(input);\n    if (result === null) {\n      throw new Error('LUT3dlLoader: Missing grid information');\n    }\n    const gridLines = result[0].trim().split(/\\s+/g).map(Number);\n    const gridStep = gridLines[1] - gridLines[0];\n    const size = gridLines.length;\n    const sizeSq = size ** 2;\n    for (let i = 1, l = gridLines.length; i < l; ++i) {\n      if (gridStep !== gridLines[i] - gridLines[i - 1]) {\n        throw new Error('LUT3dlLoader: Inconsistent grid size');\n      }\n    }\n    const dataFloat = new Float32Array(size ** 3 * 4);\n    let maxValue = 0.0;\n    let index = 0;\n    while ((result = regExpDataPoints.exec(input)) !== null) {\n      const r = Number(result[1]);\n      const g = Number(result[2]);\n      const b = Number(result[3]);\n      maxValue = Math.max(maxValue, r, g, b);\n      const bLayer = index % size;\n      const gLayer = Math.floor(index / size) % size;\n      const rLayer = Math.floor(index / sizeSq) % size;\n\n      // b grows first, then g, then r.\n      const d4 = (bLayer * sizeSq + gLayer * size + rLayer) * 4;\n      dataFloat[d4 + 0] = r;\n      dataFloat[d4 + 1] = g;\n      dataFloat[d4 + 2] = b;\n      ++index;\n    }\n\n    // Determine the bit depth to scale the values to [0.0, 1.0].\n    const bits = Math.ceil(Math.log2(maxValue));\n    const maxBitValue = Math.pow(2, bits);\n    const data = this.type === UnsignedByteType ? new Uint8Array(dataFloat.length) : dataFloat;\n    const scale = this.type === UnsignedByteType ? 255 : 1;\n    for (let i = 0, l = data.length; i < l; i += 4) {\n      const i1 = i + 1;\n      const i2 = i + 2;\n      const i3 = i + 3;\n\n      // Note: data is dataFloat when type is FloatType.\n      data[i] = dataFloat[i] / maxBitValue * scale;\n      data[i1] = dataFloat[i1] / maxBitValue * scale;\n      data[i2] = dataFloat[i2] / maxBitValue * scale;\n      data[i3] = scale;\n    }\n    const texture = new DataTexture();\n    texture.image.data = data;\n    texture.image.width = size;\n    texture.image.height = size * size;\n    texture.format = RGBAFormat;\n    texture.type = this.type;\n    texture.magFilter = LinearFilter;\n    texture.minFilter = LinearFilter;\n    texture.wrapS = ClampToEdgeWrapping;\n    texture.wrapT = ClampToEdgeWrapping;\n    texture.generateMipmaps = false;\n    texture.needsUpdate = true;\n    const texture3D = new Data3DTexture();\n    texture3D.image.data = data;\n    texture3D.image.width = size;\n    texture3D.image.height = size;\n    texture3D.image.depth = size;\n    texture3D.format = RGBAFormat;\n    texture3D.type = this.type;\n    texture3D.magFilter = LinearFilter;\n    texture3D.minFilter = LinearFilter;\n    texture3D.wrapS = ClampToEdgeWrapping;\n    texture3D.wrapT = ClampToEdgeWrapping;\n    texture3D.wrapR = ClampToEdgeWrapping;\n    texture3D.generateMipmaps = false;\n    texture3D.needsUpdate = true;\n    return {\n      size,\n      texture,\n      texture3D\n    };\n  }\n}","map":{"version":3,"names":["ClampToEdgeWrapping","DataTexture","Data3DTexture","FileLoader","FloatType","LinearFilter","Loader","RGBAFormat","UnsignedByteType","LUT3dlLoader","constructor","manager","type","setType","Error","load","url","onLoad","onProgress","onError","loader","setPath","path","setResponseType","text","parse","e","console","error","itemError","input","regExpGridInfo","regExpDataPoints","result","exec","gridLines","trim","split","map","Number","gridStep","size","length","sizeSq","i","l","dataFloat","Float32Array","maxValue","index","r","g","b","Math","max","bLayer","gLayer","floor","rLayer","d4","bits","ceil","log2","maxBitValue","pow","data","Uint8Array","scale","i1","i2","i3","texture","image","width","height","format","magFilter","minFilter","wrapS","wrapT","generateMipmaps","needsUpdate","texture3D","depth","wrapR"],"sources":["/home/ervin/Escritorio/integrador/Projecto-Integrador-1-Game/node_modules/three/examples/jsm/loaders/LUT3dlLoader.js"],"sourcesContent":["// http://download.autodesk.com/us/systemdocs/help/2011/lustre/index.html?url=./files/WSc4e151a45a3b785a24c3d9a411df9298473-7ffd.htm,topicNumber=d0e9492\n// https://community.foundry.com/discuss/topic/103636/format-spec-for-3dl?mode=Post&postID=895258\n\nimport {\n\tClampToEdgeWrapping,\n\tDataTexture,\n\tData3DTexture,\n\tFileLoader,\n\tFloatType,\n\tLinearFilter,\n\tLoader,\n\tRGBAFormat,\n\tUnsignedByteType,\n} from 'three';\n\nexport class LUT3dlLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.type = UnsignedByteType;\n\n\t}\n\n\tsetType( type ) {\n\n\t\tif ( type !== UnsignedByteType && type !== FloatType ) {\n\n\t\t\tthrow new Error( 'LUT3dlLoader: Unsupported type' );\n\n\t\t}\n\n\t\tthis.type = type;\n\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'text' );\n\t\tloader.load( url, text => {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( this.parse( text ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tthis.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( input ) {\n\n\t\tconst regExpGridInfo = /^[\\d ]+$/m;\n\t\tconst regExpDataPoints = /^([\\d.e+-]+) +([\\d.e+-]+) +([\\d.e+-]+) *$/gm;\n\n\t\t// The first line describes the positions of values on the LUT grid.\n\t\tlet result = regExpGridInfo.exec( input );\n\n\t\tif ( result === null ) {\n\n\t\t\tthrow new Error( 'LUT3dlLoader: Missing grid information' );\n\n\t\t}\n\n\t\tconst gridLines = result[ 0 ].trim().split( /\\s+/g ).map( Number );\n\t\tconst gridStep = gridLines[ 1 ] - gridLines[ 0 ];\n\t\tconst size = gridLines.length;\n\t\tconst sizeSq = size ** 2;\n\n\t\tfor ( let i = 1, l = gridLines.length; i < l; ++ i ) {\n\n\t\t\tif ( gridStep !== ( gridLines[ i ] - gridLines[ i - 1 ] ) ) {\n\n\t\t\t\tthrow new Error( 'LUT3dlLoader: Inconsistent grid size' );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst dataFloat = new Float32Array( size ** 3 * 4 );\n\t\tlet maxValue = 0.0;\n\t\tlet index = 0;\n\n\t\twhile ( ( result = regExpDataPoints.exec( input ) ) !== null ) {\n\n\t\t\tconst r = Number( result[ 1 ] );\n\t\t\tconst g = Number( result[ 2 ] );\n\t\t\tconst b = Number( result[ 3 ] );\n\n\t\t\tmaxValue = Math.max( maxValue, r, g, b );\n\n\t\t\tconst bLayer = index % size;\n\t\t\tconst gLayer = Math.floor( index / size ) % size;\n\t\t\tconst rLayer = Math.floor( index / ( sizeSq ) ) % size;\n\n\t\t\t// b grows first, then g, then r.\n\t\t\tconst d4 = ( bLayer * sizeSq + gLayer * size + rLayer ) * 4;\n\t\t\tdataFloat[ d4 + 0 ] = r;\n\t\t\tdataFloat[ d4 + 1 ] = g;\n\t\t\tdataFloat[ d4 + 2 ] = b;\n\n\t\t\t++ index;\n\n\t\t}\n\n\t\t// Determine the bit depth to scale the values to [0.0, 1.0].\n\t\tconst bits = Math.ceil( Math.log2( maxValue ) );\n\t\tconst maxBitValue = Math.pow( 2, bits );\n\n\t\tconst data = this.type === UnsignedByteType ? new Uint8Array( dataFloat.length ) : dataFloat;\n\t\tconst scale = this.type === UnsignedByteType ? 255 : 1;\n\n\t\tfor ( let i = 0, l = data.length; i < l; i += 4 ) {\n\n\t\t\tconst i1 = i + 1;\n\t\t\tconst i2 = i + 2;\n\t\t\tconst i3 = i + 3;\n\n\t\t\t// Note: data is dataFloat when type is FloatType.\n\t\t\tdata[ i ] = dataFloat[ i ] / maxBitValue * scale;\n\t\t\tdata[ i1 ] = dataFloat[ i1 ] / maxBitValue * scale;\n\t\t\tdata[ i2 ] = dataFloat[ i2 ] / maxBitValue * scale;\n\t\t\tdata[ i3 ] = scale;\n\n\t\t}\n\n\t\tconst texture = new DataTexture();\n\t\ttexture.image.data = data;\n\t\ttexture.image.width = size;\n\t\ttexture.image.height = size * size;\n\t\ttexture.format = RGBAFormat;\n\t\ttexture.type = this.type;\n\t\ttexture.magFilter = LinearFilter;\n\t\ttexture.minFilter = LinearFilter;\n\t\ttexture.wrapS = ClampToEdgeWrapping;\n\t\ttexture.wrapT = ClampToEdgeWrapping;\n\t\ttexture.generateMipmaps = false;\n\t\ttexture.needsUpdate = true;\n\n\t\tconst texture3D = new Data3DTexture();\n\t\ttexture3D.image.data = data;\n\t\ttexture3D.image.width = size;\n\t\ttexture3D.image.height = size;\n\t\ttexture3D.image.depth = size;\n\t\ttexture3D.format = RGBAFormat;\n\t\ttexture3D.type = this.type;\n\t\ttexture3D.magFilter = LinearFilter;\n\t\ttexture3D.minFilter = LinearFilter;\n\t\ttexture3D.wrapS = ClampToEdgeWrapping;\n\t\ttexture3D.wrapT = ClampToEdgeWrapping;\n\t\ttexture3D.wrapR = ClampToEdgeWrapping;\n\t\ttexture3D.generateMipmaps = false;\n\t\ttexture3D.needsUpdate = true;\n\n\t\treturn {\n\t\t\tsize,\n\t\t\ttexture,\n\t\t\ttexture3D,\n\t\t};\n\n\t}\n\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}